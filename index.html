<!-- <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Image Overlay with Download</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Make canvas container responsive */
        #canvas-container {
            width: 100%;
            max-width: 800px;
            height: auto;
        }

        #canvas {
            width: 100%;
            /* Responsive width */
            height: auto;
            /* Maintain aspect ratio */
        }
    </style>
</head>

<body style="">
    <div class="w-full h-screen flex flex-col items-center justify-center">
        <div class="flex flex-col items-center">
            <input type="file" id="imageInput" class="mb-4">
            <div id="canvas-container" class="relative w-full flex justify-center">
                <canvas id="canvas" class="border img-fluid"></canvas>
            </div>
            <button id="downloadButton" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded">Download Image</button>
        </div>
    </div>

    <script>

        // Clear localStorage on page load to start fresh
        localStorage.clear();
        const imageInput = document.getElementById("imageInput");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const downloadButton = document.getElementById("downloadButton");

        const canvasWidth = 800;
        const canvasHeight = 600;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;

        function resizeCanvas() {
            const containerWidth = document.getElementById("canvas-container").offsetWidth;
            canvas.style.width = containerWidth + "px";
            canvas.style.height = (containerWidth * canvasHeight / canvasWidth) + "px";
        }

        const baseImage = new Image();
        baseImage.src = "./WhatsApp Image 2024-10-28 at 1.29.52 PM PNG.png";
        baseImage.onload = () => {
            ctx.drawImage(baseImage, 0, 0, canvas.width, canvas.height);
            resizeCanvas();
        };

        function overlayUserImage(userImageSrc) {
            const userImage = new Image();
            userImage.src = userImageSrc;
            userImage.onload = () => {
                const overlayWidth = canvas.width * 0.7; // Cover 50% of the canvas width
                const overlayHeight = canvas.height * 0.55; // Cover 50% of the canvas height
                const centerX = (canvas.width - overlayWidth) / 2;
                const centerY = (canvas.height - overlayHeight) / 6;

                ctx.drawImage(userImage, centerX, centerY, overlayWidth, overlayHeight);
                localStorage.setItem("combinedImage", canvas.toDataURL());
            };
        }

        const storedImage = localStorage.getItem("combinedImage");
        if (storedImage) {
            const storedImageObj = new Image();
            storedImageObj.src = storedImage;
            storedImageObj.onload = () => {
                ctx.drawImage(storedImageObj, 0, 0, canvas.width, canvas.height);
                resizeCanvas();
            };
        }

        imageInput.addEventListener("change", (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    overlayUserImage(e.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        downloadButton.addEventListener("click", () => {
            const link = document.createElement("a");
            link.download = "combined-image.png";
            link.href = canvas.toDataURL("image/png");
            link.click();
        });

        window.addEventListener("resize", resizeCanvas);

    </script>
    <script>    
        document.getElementById('removeBgBtn').addEventListener('click', async () => {
            const apiKey = '8ojevHomtL8sSMEX2FJ3dHzd';  // Your API key
            const imageInput = document.getElementById('imageInput');
            const file = imageInput.files[0];

            if (!file) {
                alert("Please upload an image.");
                return;
            }

            const formData = new FormData();
            formData.append('image_file', file);
            formData.append('size', 'auto');

            try {
                const response = await fetch('https://api.remove.bg/v1.0/removebg', {
                    method: 'POST',
                    headers: {
                        'X-Api-Key': apiKey,
                    },
                    body: formData,
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    const img = document.createElement('img');
                    img.src = url;
                    img.alt = 'Background Removed Image';
                    img.style.maxWidth = '100%';
                    document.getElementById('output').innerHTML = '';  // Clear previous output
                    document.getElementById('output').appendChild(img);
                } else {
                    const errorText = await response.text();
                    console.error('Error:', response.status, errorText);
                    alert('Error: ' + response.status + ' - ' + errorText);
                }
            } catch (error) {
                console.error('Request failed:', error);
                alert('Request failed: ' + error);
            }
        });
    </script>
</body>

</html> -->


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Image Overlay with Download</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Make canvas container responsive */
        #canvas-container {
            width: 100%;
            max-width: 800px;
            height: auto;
        }

        #canvas {
            width: 100%;
            height: auto;
        }
    </style>
</head>

<body>
    <div class="w-full h-screen flex flex-col items-center justify-center">
        <div class="flex flex-col items-center">
            <input type="file" id="imageInput" class="mb-4">
            <div id="canvas-container" class="relative w-full flex justify-center">
                <canvas id="canvas" class="border img-fluid"></canvas>
            </div>
            <button id="downloadButton" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded">Download Image</button>
        </div>
    </div>

    <script>
        const imageInput = document.getElementById("imageInput");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const downloadButton = document.getElementById("downloadButton");

        const canvasWidth = 800;
        const canvasHeight = 600;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;

        function resizeCanvas() {
            const containerWidth = document.getElementById("canvas-container").offsetWidth;
            canvas.style.width = containerWidth + "px";
            canvas.style.height = (containerWidth * canvasHeight / canvasWidth) + "px";
        }

        const baseImage = new Image();
        baseImage.src = "./WhatsApp Image 2024-10-28 at 1.29.52 PM PNG.png";
        baseImage.onload = () => {
            ctx.drawImage(baseImage, 0, 0, canvas.width, canvas.height);
            resizeCanvas();
        };

        let overlayImage = null;

        function overlayUserImage(userImageSrc) {
            overlayImage = new Image();
            overlayImage.src = userImageSrc;
            overlayImage.onload = () => {
                const overlayWidth = canvas.width * 0.8;
                const overlayHeight = canvas.height * 0.55;
                const centerX = (canvas.width - overlayWidth) / 3;
                const centerY = (canvas.height - overlayHeight) / 4;

                // Draw overlay image on canvas without saving to local storage
                ctx.drawImage(baseImage, 0, 0, canvas.width, canvas.height);  // Redraw base image
                ctx.drawImage(overlayImage, centerX, centerY, overlayWidth, overlayHeight); // Draw overlay
            };
        }

        imageInput.addEventListener("change", async (event) => {
            const file = event.target.files[0];
            if (file) {
                const formData = new FormData();
                formData.append('image_file', file);
                formData.append('size', 'auto');

                try {
                    const response = await fetch('https://api.remove.bg/v1.0/removebg', {
                        method: 'POST',
                        headers: {
                            'X-Api-Key': '8ojevHomtL8sSMEX2FJ3dHzd',  // Your API key
                        },
                        body: formData,
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        const url = URL.createObjectURL(blob);

                        // Overlay user image with background removed
                        overlayUserImage(url);
                    } else {
                        const errorText = await response.text();
                        console.error('Error:', response.status, errorText);
                        alert('Error: ' + response.status + ' - ' + errorText);
                    }
                } catch (error) {
                    console.error('Request failed:', error);
                    alert('Request failed: ' + error);
                }
            }
        });

        downloadButton.addEventListener("click", () => {
            if (overlayImage) {
                const overlayWidth = canvas.width * 0.8;
                const overlayHeight = canvas.height * 0.55;
                const centerX = (canvas.width - overlayWidth) / 2;
                const centerY = (canvas.height - overlayHeight) / 2;

                ctx.drawImage(baseImage, 0, 0, canvas.width, canvas.height);  // Redraw base image
                ctx.drawImage(overlayImage, centerX, centerY, overlayWidth, overlayHeight); // Draw overlay

                // Prepare for download
                const link = document.createElement("a");
                link.download = "combined-image.png";
                link.href = canvas.toDataURL("image/png");
                link.click();
            } else {
                alert("Please upload and process an image first.");
            }
        });

        window.addEventListener("resize", resizeCanvas);
    </script>
</body>

</html>